<!doctype html> <html lang="ru"> <head> <meta charset="utf-8" /> <title>Activity Wall</title><link rel="shortcut icon" href="favicon.ico" type="image/x-icon"><meta name="viewport" content="width=device-width; initial-scale=1"> <link href="normalize.css" rel="stylesheet" type="text/css"> <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script> <script src="https://vk.com/js/api/openapi.js?167" type="text/javascript"></script> <script type="text/javascript"> var wallID, isAdmin, timer, dur, startDay = new Date(), endDay = new Date(), process = false, headerDate, followers  = [], post = ""; var Ps = {All: 0, Cur: 0, Bal: 0, OS: 0, N: 0, Ids: []}, Cs = {All: 0, Cur: 0, Bal: 0, OS: 0, N: 0, Ids: []}, TdCs = {All: 0, Cur: 0, Bal: 0, OS: 0}, Ls = {All: 0, Cur: 0, Bal: 0, OS: 0, N: 0, IdsLs: []}; const LOGIN_VK_FORM = '<div id="LoginVKForm"><div id="LoginVKFormBody"><button id="Login">Авторизоваться VK</button></div></div>', BASIC_FORM = '<div id="BasicForm"><div id="BasicFormBody"><div id="GroupRadio"><div id="Div_Yesterday">'+ '<input type="radio" name="Period" value="Yesterday" checked><label>Вчера</label>'+ '</div><div id="Div_Today"><input type="radio" name="Period" value="Today"><label>Сегодня</label>'+ '</div><div id="Div_YesterdayAndToday"><input type="radio" name="Period" value="YesterdayAndToday">'+ '<label>Вчера-Cегодня</label></div></div><button id="GetActivity">Получить</button></div></div>', RESULT_FORM = '<div id="ResultForm"><div id="ResultFormBody"><div id="ResultFormContent">'+ '<div id="ResultFormContentHeader"><div id="HeaderDate"><b>Дата: </b></div></div>'+ '<div id="ResultFormContentInfoGen">───── Посетители стены<br>Всего - <span id="AllFs">0</span>.<br>'+ 'Писали посты и комментарии - <span id="WriteFs">0</span>.<br/>Ставили только лайки - <span id="ToLikesFs">'+ '0</span>.<br>────────────────────<br/><br>───── Посты стены<br/>Всего - <span id="AllPs">0</span>.<br>'+ 'От имени группы - <span id="GroupPs">0</span>.<br>От посетителей - <span id="FollowersPs">0</span>.<br>'+ '────────────────────<br><br>───── Комментарии стены<br>Всего - <span id="AllCs">0</span>.<br>От имени группы - '+ '<span id="GroupCs">0</span>.<br>От посетителей - <span id="FollowersCs">0</span>.<br>────────────────────'+ '</div><div id="ResultFormContentInfoDet"><a href="#" id="ViewDetail">Посмотреть детально</a></div></div></div></div>', BUTTONS = '<div id="Buttons"><button id="CopyText">Копировать текст</button></div>'; var tips = "───── Подсказки\n"+ "&#128221; - Посты.\n"+ "&#128172; - Комментарии.\n"+ "&#10084; - Просто лайки или лайки которые поставили вам.\n"+ "&#128151; - Лайки которые поставили вы.\n"+ "&#128483; - Ответы на комментарии.\n"+ "&#127942; - Самое большое количество из всех.\n"+ "&#127941; - Самое большое количество набрало из всех.\n"+ "&#127941;&#128207; - Самый длинный текст.\n────────────────────", infoDet = "", endTag = "#GroupWallActivityToday\n#АктивностьСегодняСтеныГруппы"; $("document").ready(function () { LoginVK(); $("#Application").on("click", "#Login", function () { LoginVK(); }); $("#Application").on("click", "#GetActivity", function () { if($("#ResultForm").length){ if($("#Buttons").length){ $("#Buttons").remove(); } $("#ResultForm").remove(); startDay = new Date(); endDay = new Date(); process = false; followers = []; post = ""; Ps.N = 0; Ps.Ids = []; Cs.N  = 0; Cs.Ids = []; } $("#GetActivity").prop("disabled", 'disabled'); $("input[name='Period']").prop("disabled", 'disabled'); headerDate = ""; Ps.All = 0; Ps.Cur = 100; Ps.Bal = 0; Ps.OS = 0; Ls.N = 0; Ls.IdsLs = []; switch ($('input[name="Period"]:checked').val()){ case "Yesterday": startDay.setDate(startDay.getDate() - 1); startDay.setHours(0,0,0,0); endDay.setDate(endDay.getDate() - 1); endDay.setHours(23,59,59,0); headerDate = (startDay.getDate()<10?"0"+startDay.getDate():startDay.getDate())+ "."+((startDay.getMonth()+1)<10?"0"+(startDay.getMonth()+1):(startDay.getMonth()+1))+ "."+startDay.getFullYear(); break; case "Today": startDay.setHours(0,0,0,0); headerDate = (startDay.getDate()<10?"0"+startDay.getDate():startDay.getDate())+ "."+((startDay.getMonth()+1)<10?"0"+(startDay.getMonth()+1):(startDay.getMonth()+1))+ "."+startDay.getFullYear(); break; case "YesterdayAndToday": startDay.setDate(startDay.getDate() - 1); startDay.setHours(0,0,0,0); headerDate = (startDay.getDate()<10?"0"+startDay.getDate():startDay.getDate())+ "."+((startDay.getMonth()+1)<10?"0"+(startDay.getMonth()+1):(startDay.getMonth()+1))+ "."+startDay.getFullYear(); headerDate = headerDate + " - " + (endDay.getDate()<10?"0"+endDay.getDate():endDay.getDate())+ "."+((endDay.getMonth()+1)<10?"0"+(endDay.getMonth()+1):(endDay.getMonth()+1))+ "."+endDay.getFullYear(); break; } RequestVK("gPs", "wall.get", {owner_id: wallID, offset: Ps.OS, count: Ps.Cur, filter: "all", extended: 1}); }); $("#Application").on("click", "#ViewDetail", function () { $("#ViewDetail").hide(); $("#ResultFormContentInfoDet").prepend(ConvertText(1, infoDet)); }); $("#Application").on("click", "#CopyText", function () { post = ""; post = post + tips + "\n\n\n" + ConvertText(0, $("#ResultFormContentInfoGen").html()) + "\n\n\n" + infoDet +"\n\n\n" + endTag; $("body").append("<textarea id='Text'></textarea>"); $("#Text").val(post); $("#Text").select(); document.execCommand("copy"); $("#Text").remove(); NotificationOutput(-1, "Текст скопирован", true, false, 1000, 0); }); $("#Application").on("click", "#Notifications", function () { if($(".show_notifications_tips").length){ NotificationOutput(3, "", false, true, 0, 0); } else{ NotificationOutput(-1, "", false, true, 0, 0); } }); $("#Application").on("click", "#Tips", function () { if($(".show_notifications_tips").length){ NotificationOutput(3, "", false, true, 0, 0); } else{ NotificationOutput(3, ConvertText(1, tips), true, false, 0, 0); } }); $("#Application").on("click", "#Div_Yesterday", function () { $("#Div_Yesterday input").prop('checked', 'checked'); }); $("#Application").on("click", "#Div_Today", function () { $("#Div_Today input").prop('checked', 'checked'); }); $("#Application").on("click", "#Div_YesterdayAndToday", function () { $("#Div_YesterdayAndToday input").prop('checked', 'checked'); }); }); function LoginVK() { VK.Auth.login(function (date) { switch (date.status){ case "connected": $("#LoginVKForm").remove(); wallID = 187119100; RequestVK("gGp", "groups.getById", {group_id: wallID}); $("#HeadlineBody").css("visibility", "visible"); $("#ApplicationBody").append(BASIC_FORM); break; case "not_authorized": case "unknown": if(!($("#LoginVKForm").length)){ $("#ApplicationBody").prepend(LOGIN_VK_FORM); } break; } }, 335872); } function NotificationOutput(Mode, Text, Open, Close, DurOpen, DurClose) { var classNotifications; if((Mode == 0 || Mode == 2) && Open){ clearTimeout(timer); LoadingBarAnimation(false); } switch (Mode){ case 0: classNotifications = "notifications error_notifications"; break; case 1: classNotifications = "notifications warning_notifications"; break; case 2: classNotifications = "notifications success_notifications"; break; case 3: classNotifications = "notifications tips_notifications"; break; default: classNotifications = "notifications notifications_default"; } if(Open){ setTimeout(function () { $("#Notifications").removeClass(); $("#Notifications").html(Text); $("#Notifications").addClass(classNotifications); switch (Mode){ case 3: $("#Notifications").addClass("show_notifications_tips"); break; default: $("#Notifications").addClass("show_notifications"); } }, DurOpen); } if(Close){ setTimeout(function () { $("#Notifications").removeClass("show_notifications"); switch (Mode){ case 3: $("#Notifications").addClass("hide_notifications_tips"); break; default: $("#Notifications").addClass("hide_notifications"); } setTimeout(function() { $("#Notifications").removeClass(); $("#Notifications").html("") }, 1000); }, DurClose); } } function LoadingBarAnimation(Process) { if(Process){ $("#LoadingBar").show(); $("#Bar").addClass("show_bar"); } else{ $("#Bar").removeClass(); $("#LoadingBar").hide(); } } function RequestVK(Mode, Method, Parameters) { Parameters = Parameters || {}; Parameters["v"] = '5.103'; VK.Api.call(Method, Parameters, function (data) { var userName; switch (Mode) { case "gGp": if(data != undefined && !("error" in data)){ dur = 340; $("#GroupIcon").css("backgroundImage","url('"+data.response[0].photo_50+"')"); $("#GroupName").html(data.response[0].name); isAdmin = data.response[0].is_admin; wallID = -wallID; } else{ NotificationOutput(0, "Error: data undefined or error!", true, false, 0, 0); console.log("Error gGp: data undefined or error!"); console.log(data); } break; case "gPs": if(data != undefined && !("error" in data)){if(data.response.count > 0){ var responseDate; if(Ps.OS == 0){ $("#Theme").hide(); LoadingBarAnimation(true); $("#ApplicationBody").append(RESULT_FORM); $("#HeaderDate").append(headerDate); Ps.All = data.response.count; if(Ps.All < 100){ Ps.Cur = Ps.All; } Ps.Bal = Ps.All; } dur = 340; Ps.N = 0; Ps.Ids = []; for(var i = 0; i < data.response.items.length; i++){ responseDate = String(data.response.items[i].date) + "000"; if(+startDay < +responseDate && +endDay > +responseDate){ if(SearchFollower(data.response.items[i].from_id)){ for(var j = 0; j < followers.length; j++){ if(followers[j].Id == data.response.items[i].from_id){ followers[j].Posts = followers[j].Posts + 1; if(data.response.items[i].likes !== undefined){ followers[j].InLikes = followers[j].InLikes + data.response.items[i].likes.count; if(followers[j].LikesPs < data.response.items[i].likes.count){ followers[j].LikesPs = data.response.items[i].likes.count; followers[j].UrlLikesPs = "https://vk.com/wall"+wallID+"_"+ data.response.items[i].id; } } if(followers[j].CommentsPs < data.response.items[i].comments.count){ followers[j].CommentsPs = data.response.items[i].comments.count; followers[j].UrlCommentsPs = "https://vk.com/wall"+wallID+"_"+ data.response.items[i].id;; } if(followers[j].TextPs < data.response.items[i].text.length){ followers[j].TextPs = data.response.items[i].text.length; followers[j].UrlTextPs = "https://vk.com/wall"+wallID+"_"+ data.response.items[i].id;; } } } dur = dur > 0 ? dur - 1 : dur; } else{ for(var j = 0; j < data.response.profiles.length; j++){ if(data.response.items[i].from_id == data.response.profiles[j].id){ userName = data.response.profiles[j].first_name+" "+data.response.profiles[j].last_name; } } for(var j = 0; j < data.response.groups.length; j++){ if(data.response.items[i].from_id == -data.response.groups[j].id){ userName = data.response.groups[j].name; } } followers.push({Id: data.response.items[i].from_id, UserName: userName, Posts: 1, Comments: 0, InLikes: 0, OutLikes: 0, LikesPs: 0, CommentsPs: 0, TextPs: data.response.items[i].text.length, LikesCs: 0, AnswersCs: 0, TextCs: 0, UrlLikesPs: "", UrlCommentsPs: "", UrlTextPs: "", UrlLikesCs: "", UrlAnswersCs: "", UrlTextCs: ""}); followers[followers.length-1].UrlTextPs = "https://vk.com/wall"+wallID+"_"+ data.response.items[i].id; if(data.response.items[i].likes !== undefined){ followers[followers.length-1].InLikes = data.response.items[i].likes.count; followers[followers.length-1].LikesPs = data.response.items[i].likes.count; followers[followers.length-1].UrlLikesPs = "https://vk.com/wall"+wallID+"_"+ data.response.items[i].id; } if(data.response.items[i].comments.count > 0){ followers[followers.length-1].CommentsPs = data.response.items[i].comments.count; followers[followers.length-1].UrlCommentsPs = "https://vk.com/wall"+wallID+"_"+ data.response.items[i].id;; } if(data.response.items[i].from_id != wallID){ $("#WriteFs").html(+$("#WriteFs").html() + 1); $("#AllFs").html(+$("#AllFs").html() + 1); } dur = dur > 0 ? dur - 1 : dur; } if(data.response.items[i].from_id == wallID){ $("#GroupPs").html(+$("#GroupPs").html() + 1); } else{ $("#FollowersPs").html(+$("#FollowersPs").html() + 1); } $("#AllPs").html(+$("#AllPs").html() + 1); if(data.response.items[i].likes !== undefined){ if(data.response.items[i].likes.count > 0){ Ls.IdsLs.push({type: "post", owner_id: wallID, item_id: data.response.items[i].id, filter: "likes", extended: 1, skip_own: 0, fields: "photo_50,sex"}); } } if(data.response.items[i].comments.count > 0){ Ps.Ids.push(data.response.items[i].id); dur = dur > 0 ? dur - 1 : dur; } process = true; } else{ if(+endDay < +responseDate){ process = true; } else{ process = false; } } } workIdsPosts(); } else{ NotificationOutput(0, "Стена пустая!", true, true, 0, 5000); } } else{ NotificationOutput(0, "Error: data undefined or error!", true, false, 0, 0); console.log("Error gPs: data undefined or error!"); console.log(data); } break; case "gCs": if(data != undefined && !("error" in data)){ if(data.response.current_level_count > 0){ if(Cs.OS == 0){ Cs.All = data.response.current_level_count; if(Cs.All < 100){ Cs.Cur = Cs.All; } Cs.Bal = Cs.All; } dur = 340; Cs.N = 0; Cs.Ids = []; for(var i = 0; i < data.response.items.length; i++) { if("from_id" in data.response.items[i]){ if(SearchFollower(data.response.items[i].from_id)){ for(var j = 0; j < followers.length; j++){ if(followers[j].Id == data.response.items[i].from_id){ followers[j].Comments = followers[j].Comments + 1; if(data.response.items[i].likes !== undefined){ followers[j].InLikes = followers[j].InLikes + data.response.items[i].likes.count; if(followers[j].LikesCs < data.response.items[i].likes.count){ followers[j].LikesCs = data.response.items[i].likes.count; followers[j].UrlLikesCs = "https://vk.com/wall"+wallID+"_"+ data.response.items[i].post_id+ "?reply="+data.response.items[i].id; } } if(followers[j].AnswersCs < data.response.items[i].thread.count){ followers[j].AnswersCs = data.response.items[i].thread.count; followers[j].UrlAnswersCs = "https://vk.com/wall"+wallID+"_"+ data.response.items[i].post_id+ "?reply="+data.response.items[i].id; } if(followers[j].TextCs < data.response.items[i].text.length){ followers[j].TextCs = data.response.items[i].text.length; followers[j].UrlTextCs = "https://vk.com/wall"+wallID+"_"+ data.response.items[i].post_id+ "?reply="+data.response.items[i].id; } } } dur = dur > 0 ? dur - 1 : dur; } else{ for(var j = 0; j < data.response.profiles.length; j++){ if(data.response.items[i].from_id == data.response.profiles[j].id){ userName = data.response.profiles[j].first_name+" "+data.response.profiles[j].last_name; } } for(var j = 0; j < data.response.groups.length; j++){ if(data.response.items[i].from_id == -data.response.groups[j].id){ userName = data.response.groups[j].name; } } followers.push({Id: data.response.items[i].from_id, UserName: userName, Posts: 0, Comments: 1, InLikes: 0, OutLikes: 0, LikesPs: 0, CommentsPs: 0, TextPs: 0, LikesCs: 0, AnswersCs: 0, TextCs: data.response.items[i].text.length, UrlLikesPs: "", UrlCommentsPs: "", UrlTextPs: "", UrlLikesCs: "", UrlAnswersCs: "", UrlTextCs: ""}); followers[followers.length-1].UrlTextCs = "https://vk.com/wall"+wallID+"_"+ data.response.items[i].post_id+ "?reply="+data.response.items[i].id; if(data.response.items[i].likes !== undefined){ followers[followers.length-1].InLikes = data.response.items[i].likes.count; followers[followers.length-1].LikesCs = data.response.items[i].likes.count; followers[followers.length-1].UrlLikesCs = "https://vk.com/wall"+wallID+"_"+ data.response.items[i].post_id+ "?reply="+data.response.items[i].id; } if(data.response.items[i].thread.count > 0){ followers[followers.length-1].AnswersCs = data.response.items[i].thread.count; followers[followers.length-1].UrlAnswersCs = "https://vk.com/wall"+wallID+"_"+ data.response.items[i].post_id+ "?reply="+data.response.items[i].id; } if(data.response.items[i].from_id != wallID){ $("#WriteFs").html(+$("#WriteFs").html() + 1); $("#AllFs").html(+$("#AllFs").html() + 1); } dur = dur > 0 ? dur - 1 : dur; } } if(data.response.items[i].from_id == wallID){ $("#GroupCs").html(+$("#GroupCs").html() + 1); } else{ $("#FollowersCs").html(+$("#FollowersCs").html() + 1); } $("#AllCs").html(+$("#AllCs").html() + 1); if(data.response.items[i].likes !== undefined){ if(data.response.items[i].likes.count > 0){ Ls.IdsLs.push({type: "comment", owner_id: wallID, item_id: data.response.items[i].id, filter: "likes", extended: 1, skip_own: 0, fields: "photo_50,sex"}); } } if(data.response.items[i].thread.count > 0){ Cs.Ids.push(data.response.items[i].id); dur = dur > 0 ? dur - 1 : dur; } } workIdsComments(); } else{ dur = 340; Ps.N = Ps.N + 1; workIdsPosts(); } } else{ NotificationOutput(0, "Error: data undefined or error!", true, false, 0, 0); console.log("Error gCs: data undefined or error!"); console.log(data); } break; case "gTdCs": if(data != undefined && !("error" in data)){ if(data.response.count > 0){ if(TdCs.OS == 0){ TdCs.All = data.response.count; if(TdCs.All < 100){ TdCs.Cur = TdCs.All; } TdCs.Bal = TdCs.All; } dur = 340; for(var i = 0; i < data.response.items.length; i++){ if("from_id" in data.response.items[i]){ if(SearchFollower(data.response.items[i].from_id)){ for(var j = 0; j < followers.length; j++){ if(followers[j].Id == data.response.items[i].from_id){ followers[j].Comments = followers[j].Comments + 1; if(data.response.items[i].likes !== undefined){ followers[j].InLikes = followers[j].InLikes + data.response.items[i].likes.count; if(followers[j].LikesCs < data.response.items[i].likes.count){ followers[j].LikesCs = data.response.items[i].likes.count; followers[j].UrlLikesCs = "https://vk.com/wall"+wallID+"_"+ data.response.items[i].post_id+ "?thread="+data.response.items[i].parents_stack+ "&reply="+data.response.items[i].id; } } if(followers[j].TextCs < data.response.items[i].text.length){ followers[j].TextCs = data.response.items[i].text.length; followers[j].UrlTextCs = "https://vk.com/wall"+wallID+"_"+ data.response.items[i].post_id+ "?thread="+data.response.items[i].parents_stack+ "&reply="+data.response.items[i].id; } } } dur = dur > 0 ? dur - 1 : dur; } else{ for(var j = 0; j < data.response.profiles.length; j++){ if(data.response.items[i].from_id == data.response.profiles[j].id){ userName = data.response.profiles[j].first_name+" "+data.response.profiles[j].last_name; } } for(var j = 0; j < data.response.groups.length; j++){ if(data.response.items[i].from_id == -data.response.groups[j].id){ userName = data.response.groups[j].name; } } followers.push({Id: data.response.items[i].from_id, UserName: userName, Posts: 0, Comments: 1, InLikes: 0, OutLikes: 0, LikesPs: 0, CommentsPs: 0, TextPs: 0, LikesCs: 0, AnswersCs: 0, TextCs: data.response.items[i].text.length, UrlLikesPs: "", UrlCommentsPs: "", UrlTextPs: "", UrlLikesCs: "", UrlAnswersCs: "", UrlTextCs: ""}); followers[followers.length-1].UrlTextCs = "https://vk.com/wall"+wallID+"_"+ data.response.items[i].post_id+ "?thread="+data.response.items[i].parents_stack+ "&reply="+data.response.items[i].id; if(data.response.items[i].likes !== undefined){ followers[followers.length-1].InLikes = data.response.items[i].likes.count; followers[followers.length-1].LikesCs = data.response.items[i].likes.count; followers[followers.length-1].UrlLikesCs = "https://vk.com/wall"+wallID+"_"+ data.response.items[i].post_id+ "?thread="+data.response.items[i].parents_stack+ "&reply="+data.response.items[i].id; } if(data.response.items[i].from_id != wallID){ $("#WriteFs").html(+$("#WriteFs").html() + 1); $("#AllFs").html(+$("#AllFs").html() + 1); } dur = dur > 0 ? dur - 1 : dur; } } if(data.response.items[i].from_id == wallID){ $("#GroupCs").html(+$("#GroupCs").html() + 1); } else{ $("#FollowersCs").html(+$("#FollowersCs").html() + 1); } $("#AllCs").html(+$("#AllCs").html() + 1); if(data.response.items[i].likes !== undefined){ if(data.response.items[i].likes.count > 0){ Ls.IdsLs.push({type: "comment", owner_id: wallID, item_id: data.response.items[i].id, filter: "likes", extended: 1, skip_own: 0, fields: "photo_50,sex"}); } } } TdCs.OS = TdCs.OS + TdCs.Cur; TdCs.Bal = TdCs.Bal - TdCs.Cur; if(TdCs.Bal < 100){ TdCs.Cur = TdCs.Bal; } if(TdCs.OS < TdCs.All){ timer = setTimeout(RequestVK, dur, "gTdCs", "wall.getComments", {owner_id: wallID, post_id: Ps.Ids[Ps.N], comment_id: Cs.Ids[Cs.N], need_likes: 1, offset: TdCs.OS, count: TdCs.Cur, extended: 1}); } else{ Cs.N = Cs.N + 1; workIdsComments(); } } else{ dur = 340; Cs.N = Cs.N + 1; workIdsComments(); } } else{ NotificationOutput(0, "Error: data undefined or error!", true, false, 0, 0); console.log("Error gTdCs: data undefined or error!"); console.log(data); } break; case "gLs": if(data != undefined && !("error" in data)){ if(data.response.count > 0){ if(Ls.IdsLs[Ls.N].offset == 0){ Ls.All = data.response.count; if(Ls.All < 1000){ Ls.IdsLs[Ls.N].count = Ls.All; } Ls.Bal = Ls.All; } dur = 340; for(var i = 0; i < data.response.items.length; i++){ if(SearchFollower(data.response.items[i].id)){ for(var j = 0; j < followers.length; j++){ if(followers[j].Id == data.response.items[i].id){ followers[j].OutLikes = followers[j].OutLikes + 1; } } dur = dur > 0 ? dur - 1 : dur; } else{ if(data.response.items[i].type == "profile"){ userName = data.response.items[i].first_name+" "+data.response.items[i].last_name; } if(data.response.items[i].type == "group"){ userName = data.response.items[i].name; } followers.push({Id: data.response.items[i].id, UserName: userName, Posts: 0, Comments: 0, InLikes: 0, OutLikes: 1, LikesPs: 0, CommentsPs: 0, TextPs: 0, LikesCs: 0, AnswersCs: 0, TextCs: 0, UrlLikesPs: "", UrlCommentsPs: "", UrlTextPs: "", UrlLikesCs: "", UrlAnswersCs: "", UrlTextCs: ""}); if(data.response.items[i].from_id != wallID){ $("#ToLikesFs").html(+$("#ToLikesFs").html() + 1); $("#AllFs").html(+$("#AllFs").html() + 1); } dur = dur > 0 ? dur - 1 : dur; } } Ls.IdsLs[Ls.N].offset = Ls.IdsLs[Ls.N].offset + Ls.IdsLs[Ls.N].count; Ls.Bal = Ls.Bal - Ls.IdsLs[Ls.N].count; if(Ls.Bal < 1000){ Ls.IdsLs[Ls.N].count = Ls.Bal; } if(Ls.IdsLs[Ls.N].offset < Ls.All){ timer = setTimeout(RequestVK, dur, "gLs", "likes.getList", Ls.IdsLs[Ls.N]); } else{ Ls.N = Ls.N + 1; workIdsLikes(); } } else{ dur = 340; Ls.N = Ls.N + 1; workIdsLikes(); } } else{ NotificationOutput(0, "Error: data undefined or error!", true, false, 0, 0); console.log("Error gLs: data undefined or error!"); console.log(data); } break; } }); } function workIdsPosts() { if(Ps.N < Ps.Ids.length){ Cs.All = 0; Cs.Cur = 100; Cs.Bal = 0; Cs.OS = 0; timer = setTimeout(RequestVK, dur, "gCs", "wall.getComments", {owner_id: wallID, post_id: Ps.Ids[Ps.N], need_likes: 1, offset: Cs.OS, count: Cs.Cur, extended: 1}); } else{ Ps.OS = Ps.OS + Ps.Cur; Ps.Bal = Ps.Bal - Ps.Cur; if(Ps.Bal < 100){ Ps.Cur = Ps.Bal; } if(process && Ps.OS < Ps.All){ timer = setTimeout(RequestVK, dur, "gPs", "wall.get", {owner_id: wallID, offset: Ps.OS, count: Ps.Cur, filter: "all", extended: 1}); } else{ Ls.N = 0; workIdsLikes(); } } } function workIdsComments() { if(Cs.N < Cs.Ids.length){ TdCs.All = 0; TdCs.Cur = 100; TdCs.Bal = 0; TdCs.OS = 0; timer = setTimeout(RequestVK, dur, "gTdCs", "wall.getComments", {owner_id: wallID, post_id: Ps.Ids[Ps.N], comment_id: Cs.Ids[Cs.N], need_likes: 1, offset: TdCs.OS, count: TdCs.Cur, extended: 1}); } else { Cs.OS = Cs.OS + Cs.Cur; Cs.Bal = Cs.Bal - Cs.Cur; if(Cs.Bal < 100){ Cs.Cur = Cs.Bal; } if(Cs.OS < Cs.All){ timer = setTimeout(RequestVK, dur, "gCs", "wall.getComments", {owner_id: wallID, post_id: Ps.Ids[Ps.N], need_likes: 1, offset: Cs.OS, count: Cs.Cur, extended: 1}); } else{ Ps.N = Ps.N + 1; workIdsPosts(); } } } function workIdsLikes() { if(Ls.N < Ls.IdsLs.length){ Ls.All = 0; Ls.IdsLs[Ls.N]["count"] = 1000; Ls.Bal = 0; Ls.IdsLs[Ls.N]["offset"] = 0; timer = setTimeout(RequestVK, dur, "gLs", "likes.getList", Ls.IdsLs[Ls.N]); } else{ Calculate(); } } function Calculate() { var Many = {Ps: 0, Cs: 0, InLs: 0, OutLs: 0, likesPs: 0, commentsPs: 0, textPs: 0, likesCs: 0, answersCs: 0, textCs: 0, namesPs: "", namesCs: "", namesInLs: "", namesOutLs: "", urlLikesPs: "", urlCommentsPs: "", urlTextPs: "", urlLikesCs: "", urlAnswersCs: "", urlTextCs: ""}, buffer = "", prs, c1='', c2='', c3='', c4='', c5='', c6='', c7='', c8='', c9='', c10=''; for(var i = 0; i < followers.length; i++){ for(var j = 0; j < followers.length; j++){ if(followers[i].Id != wallID && followers[j].Id != wallID){ if(followers[i].Posts < followers[j].Posts){ if(Many.Ps < followers[j].Posts){ Many.Ps = followers[j].Posts; } } else if(Many.Ps < followers[i].Posts){ Many.Ps = followers[i].Posts; } if(followers[i].Comments < followers[j].Comments){ if(Many.Cs < followers[j].Comments){ Many.Cs = followers[j].Comments; } } else if(Many.Cs < followers[i].Comments){ Many.Cs = followers[i].Comments; } if(followers[i].InLikes < followers[j].InLikes){ if(Many.InLs < followers[j].InLikes){ Many.InLs = followers[j].InLikes; } } else if(Many.InLs < followers[i].InLikes){ Many.InLs = followers[i].InLikes; } if(followers[i].OutLikes < followers[j].OutLikes){ if(Many.OutLs < followers[j].OutLikes){ Many.OutLs = followers[j].OutLikes; } } else if(Many.OutLs < followers[i].OutLikes){ Many.OutLs = followers[i].OutLikes; } if(followers[i].LikesPs < followers[j].LikesPs){ if(Many.likesPs < followers[j].LikesPs){ Many.likesPs = followers[j].LikesPs; } } else if(Many.likesPs < followers[i].LikesPs){ Many.likesPs = followers[i].LikesPs; } if(followers[i].CommentsPs < followers[j].CommentsPs){ if(Many.commentsPs < followers[j].CommentsPs){ Many.commentsPs = followers[j].CommentsPs; } } else if(Many.commentsPs < followers[i].CommentsPs){ Many.commentsPs = followers[i].CommentsPs; } if(followers[i].TextPs < followers[j].TextPs){ if(Many.textPs < followers[j].TextPs){ Many.textPs = followers[j].TextPs; } } else if(Many.textPs < followers[i].TextPs){ Many.textPs = followers[i].TextPs; } if(followers[i].LikesCs < followers[j].LikesCs){ if(Many.likesCs < followers[j].LikesCs){ Many.likesCs = followers[j].LikesCs; } } else if(Many.likesCs < followers[i].LikesCs){ Many.likesCs = followers[i].LikesCs; } if(followers[i].AnswersCs < followers[j].AnswersCs){ if(Many.answersCs < followers[j].AnswersCs){ Many.answersCs = followers[j].AnswersCs; } } else if(Many.answersCs < followers[i].AnswersCs){ Many.answersCs = followers[i].AnswersCs; } if(followers[i].TextCs < followers[j].TextCs){ if(Many.textCs < followers[j].TextCs){ Many.textCs = followers[j].TextCs; } } else if(Many.textCs < followers[i].TextCs){ Many.textCs = followers[i].TextCs; } } } } for(var i = 0; i < followers.length; i++){ if(followers[i].Id != wallID){ prs = 0; buffer = ""; if(followers[i].Posts > 0){ prs = prs + 1; if(followers[i].Posts == Many.Ps){ buffer = buffer + "&#127942;"; } buffer = buffer + "&#128221;: "+followers[i].Posts; } if(followers[i].Comments > 0){ prs = prs + 1; if(buffer != ""){ buffer = buffer + ",  "; } if(followers[i].Comments == Many.Cs){ buffer = buffer + "&#127942;"; } buffer = buffer + "&#128172;: "+followers[i].Comments; } if(followers[i].InLikes > 0){ prs = prs + 1; if(buffer != ""){ buffer = buffer + ",  "; } if(followers[i].InLikes == Many.InLs){ buffer = buffer + "&#127942;"; } buffer = buffer + "&#10084;: "+followers[i].InLikes; } if(followers[i].OutLikes > 0){ prs = prs + 1; if(buffer != ""){ buffer = buffer + ",  "; } if(followers[i].OutLikes == Many.OutLs){ buffer = buffer + "&#127942;"; } buffer = buffer + "&#128151;: "+followers[i].OutLikes; } buffer = buffer + "."; if(followers[i].LikesPs > 0){ if(followers[i].LikesPs == Many.likesPs){ prs = prs + 1; buffer = buffer + "\n&#127941;&#10084;&#128221;: " + followers[i].UrlLikesPs; } } if(followers[i].CommentsPs > 0){ if(followers[i].CommentsPs == Many.commentsPs){ prs = prs + 1; buffer = buffer + "\n&#127941;&#128172;&#128221;: " + followers[i].UrlCommentsPs; } } if(followers[i].TextPs > 0){ if(followers[i].TextPs == Many.textPs){ prs = prs + 1; buffer = buffer + "\n&#127941;&#128207;&#128221;: " + followers[i].UrlTextPs; } } if(followers[i].LikesCs > 0){ if(followers[i].LikesCs == Many.likesCs){ prs = prs + 1; buffer = buffer + "\n&#127941;&#10084;&#128172;: " + followers[i].UrlLikesCs; } } if(followers[i].AnswersCs > 0){ if(followers[i].AnswersCs == Many.answersCs){ prs = prs + 1; buffer = buffer + "\n&#127941;&#128483;&#128172;: " + followers[i].UrlAnswersCs; } } if(followers[i].TextCs > 0){ if(followers[i].TextCs == Many.textCs){ prs = prs + 1; buffer = buffer + "\n&#127941;&#128207;&#128172;: " + followers[i].UrlTextCs; } } switch (prs){case 1: c10 = c10 + "\n" + "─".repeat(20) + "\n" + followers[i].UserName + "\n" + buffer; break;case 2: c9 = c9 + "\n" + "─".repeat(20) + "\n" + followers[i].UserName + "\n" + buffer; break;case 3: c8 = c8 + "\n" + "─".repeat(20) + "\n" + followers[i].UserName + "\n" + buffer; break;case 4: c7 = c7 + "\n" + "─".repeat(20) + "\n" + followers[i].UserName + "\n" + buffer; break;case 5: c6 = c6 + "\n" + "─".repeat(20) + "\n" + followers[i].UserName + "\n" + buffer; break;case 6: c5 = c5 + "\n" + "─".repeat(20) + "\n" + followers[i].UserName + "\n" + buffer; break;case 7: c4 = c4 + "\n" + "─".repeat(20) + "\n" + followers[i].UserName + "\n" + buffer; break;case 8: c3 = c3 + "\n" + "─".repeat(20) + "\n" + followers[i].UserName + "\n" + buffer; break;case 9: c2 = c2 + "\n" + "─".repeat(20) + "\n" + followers[i].UserName + "\n" + buffer; break;case 10: c1 = c1 + "\n" + "─".repeat(20) + "\n" + followers[i].UserName + "\n" + buffer; break; } } } infoDet = infoDet + c1 + c2 + c3 + c4 + c5 + c6 + c7 + c8 + c9 + c10 + "\n" + "─".repeat(20); infoDet = infoDet.substring(1, infoDet.length); NotificationOutput(2, "√ Готово!", true, false, 0, 0); $("#ResultFormContentInfoDet").show(); $("#ViewDetail").fadeTo(400, 1); $("#GetActivity").prop("disabled", false); $("input[name='Period']").prop("disabled", false); switch(isAdmin){ case 0: $("#Theme").show(); break; case 1: $("#HeadlineBody").append(BUTTONS); break; } } function SearchFollower(id){ for(var i = 0; i < followers.length; i++){ if(followers[i].Id == id){ return true; } } return false; } function ConvertText(Mode, Text) { var emotions = [{text: '&#128221;', image: '<img src="https://vk.com/emoji/e/f09f939d.png">'}, {text: '&#128172;', image: '<img src="https://vk.com/emoji/e/f09f92ac.png">'}, {text: '&#10084;', image: '<img src="https://vk.com/emoji/e/e29da4.png">'}, {text: '&#128151;', image: '<img src="https://vk.com/emoji/e/f09f9297.png">'}, {text: '&#128483;', image: '<img src="https://vk.com/emoji/e/f09f97a3.png">'}, {text: '&#127942;', image: '<img src="https://vk.com/emoji/e/f09f8f86.png">'}, {text: '&#127941;', image: '<img src="https://vk.com/emoji/e/f09f8f85.png">'}, {text: '&#128207', image: '<img src="https://vk.com/emoji/e/f09f938f.png">'}], re; switch (Mode){ case 0: Text = Text.replace(/<br>/g, "\n"); Text = Text.replace(/<.*>(.*)<.*>/g, function (ftext1, ftext2) { return ftext2; }); break; case 1: Text = Text.replace(/https.*/g, function (ftext) { return '<a href="'+ftext+'" onclick="return !window.open(this.href)">Перейти</a>'; }); for(var i = 0; i < emotions.length; i++){ re = new RegExp(emotions[i].text, "g"); Text = Text.replace(re, emotions[i].image); } Text = Text.replace(/\n/g, "<br>"); break; } return Text; } </script> <style> *{ box-sizing: border-box; } html, body{ background: #008000; width: 100%; height: 100%; position: absolute; left: 0; } .notifications{ width: 450px; display: inline-block; position: fixed; z-index: 1; left: calc(50% - 225px); top: 26px; font-family: Tahoma; line-height: 43px; vertical-align: middle; text-transform: uppercase; font-weight: bold; text-align: center; border-width: 2px; border-style: solid; border-top: none; border-radius: 0 0 20px 20px; } .notifications_default{ background-color: #9999ff; color: #000066; border-color: #0000ff; } .error_notifications{ background-color: #ff9999; color: #990000; border-color: #ff0000; } .warning_notifications{ background-color: #ffff99; color: #666600; border-color: #ffff00; } .success_notifications{ background-color: #80ff80; color: #001a00; border-color: #008000; } .tips_notifications{ background: #b3ffb3; color: rgba(0, 26, 0, 0.9); top: -125px; padding-left: 20px; line-height: normal; text-transform: none; font-weight: normal; text-align: left; border-color: rgba(0, 77, 0, 0.4); } .show_notifications{ animation-name: DownNs; animation-duration: 700ms; animation-timing-function: linear; animation-iteration-count: 1; animation-fill-mode: forwards; } .hide_notifications{ animation-name: UpNs; animation-duration: 700ms; animation-timing-function: linear; animation-iteration-count: 1; animation-fill-mode: forwards; } .show_notifications_tips{ animation-name: DownNsTips; animation-duration: 700ms; animation-timing-function: linear; animation-iteration-count: 1; animation-fill-mode: forwards; } .hide_notifications_tips{ animation-name: UpNsTips; animation-duration: 700ms; animation-timing-function: linear; animation-iteration-count: 1; animation-fill-mode: forwards; } .square{ background: rgba(190, 245, 116, 0.7); margin:0 26px 0 0; width: 26px; height: 100%; display: inline-block; } .show_bar{ animation-name: Bar; animation-duration: 300ms; animation-timing-function: linear; animation-iteration-count: infinite; } #Application{ width: 100%; height: 100%; position: absolute; left: 0; } #Headline{ background: #004d00; width: inherit; padding: 5px 0 5px 0; position: fixed; z-index: 2; top: 0; border-bottom: 1px solid #ffffff; white-space: nowrap; } #HeadlineBody{ width: 450px; margin: 0 auto; position: relative; visibility: hidden; } #GroupIcon{ background: #ffffff; background-size: 53px 53px; background-position: -1px -2px; background-repeat: no-repeat; width: 50px; height: 50px; display: inline-block; border: 2px solid #ffffff; border-radius: 50%; box-sizing: content-box; } #GroupName{ color: #ffffff; width: calc(100% - 63px); margin: -68px 0 0 5px; display: inline-block; vertical-align: middle; font-size: 20px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; } #Theme{ color: #ffffff; width: calc(100% - 69px); padding-top: 2px; position: absolute; top: 30px; left: 63px; font-style: italic; border-top: 1px solid rgba(255, 255, 255, 0.7); } #Tips{ background: #b3ffb3; width: 25px; height: 25px; position: absolute; top: 31px; left: 31px; display: inline-block; cursor: pointer; font-family: Tahoma; font-size: 15px; text-align: center; line-height: 25px; vertical-align: middle; border-radius: 50%; border: 1px solid rgba(0, 77, 0, 0.4); } #Loading{ width: calc(100% - 71px); height: 15px; position: absolute; top: 40px; left: 63px; display: inline-block; overflow: hidden; box-sizing: content-box; } #LoadingBar{ width: 100%; height: 100%; text-align: left; display: none; overflow: hidden; } #Bar{ width: 100%; height: 100%; position: relative; white-space: nowrap; display: inline-block; box-sizing: border-box; } #Buttons{ width: calc(100% - 69px); padding-top: 5px; position: absolute; top: 30px; left: 63px; border-top: 1px solid rgba(255, 255, 255, 0.7); } #CopyText{ background: rgba(190, 245, 116, 0.7); color: rgba(0, 0, 0, 0.8); padding: 5px 8pt; font-family: Tahoma; font-size: 7pt; cursor: pointer; border: 1px solid rgba(0, 77, 0, 0.8); border-radius: 10px; transition-property: color; transition-duration: 0.3s; transition-timing-function: ease-in-out; } #CopyText:hover, #CopyText:focus{ background: rgba(190, 245, 116, 0.8); outline: none; border: 1px solid rgba(0, 77, 0, 1); } #CopyText:active{ color: #ffffff; } #ApplicationBody{ width: 100%; margin-top: 81px; } #LoginVKForm{ width: 100%; padding: 20% 0; } #LoginVKFormBody{ width: 450px; margin: 0 auto; text-align: center; } #Login{ background: #4A76A8; color: rgba(230, 255, 230, 0.8); padding: 10px 15px; display: inline-block; font-family: Tahoma; font-size: 20pt; cursor: pointer; border: 1px solid rgba(0, 77, 0, 0.8); border-radius: 10px; transition-property: color; transition-duration: 0.3s; transition-timing-function: ease-in-out; } #Login:hover, #Login:focus{ color: rgba(230, 255, 230, 1); outline: none; border: 1px solid rgba(0, 77, 0, 1); } #BasicForm{ width: 100%; padding: 0; } #BasicFormBody{ width: 450px; margin: 0 auto; text-align: center; line-height: 24px; vertical-align: middle; } #GroupRadio{ background: rgba(0, 230, 0, 0.5); color: #001a00; padding: 2px 0; display: inline-block; border: 1px solid #001a00; border-radius: 10px; } #GroupRadio div{ padding: 0 10px; display: inline-block; } #GroupRadio div input{ position: relative; top: 2px; } #GroupRadio div label{ padding-left: 3px; font-size: 12px; user-select: none; } #GetActivity{ background: #004d00; color: rgba(230, 255, 230, 0.8); margin-left: 10px; padding: 6px 10px; display: inline-block; font-family: Tahoma; cursor: pointer; font-size: 12px; border: 1px solid rgba(0, 77, 0, 0.8); border-radius: 10px; transition-property: color; transition-duration: 0.3s; transition-timing-function: ease-in-out; } #GetActivity:hover, #GetActivity:focus{ color: rgba(230, 255, 230, 1); outline: none; border: 1px solid rgba(0, 77, 0, 1); } #GetActivity:disabled{ background: #001a00; color: rgba(230, 255, 230, 1); font-weight: bold; } #ResultForm{ width: 100%; padding: 10px 0 10px 0; } #ResultFormBody{ background: #b3ffb3; width: 450px; margin: 0 auto; padding: 10px; border-radius: 30px; } #ResultFormContent{ width: 100%; border: 1px solid rgba(0, 77, 0, 0.4); border-radius: 30px; } #ResultFormContentHeader{ border-bottom: 1px solid rgba(0, 77, 0, 0.4); } #HeaderDate{ color: #001a00; padding: 5px 0; font-family: Tahoma; text-align: center; } #ResultFormContentInfoGen{ color: rgba(0, 26, 0, 0.9); padding: 10px 0 10px 10px; font-style: italic; } #ResultFormContentInfoDet{ color: rgba(0, 26, 0, 0.9); padding: 0 0 15px 10px; line-height: 28px; display: none; font-style: italic; white-space: nowrap; } #ResultFormContentInfoDet img { margin: 0 2px; } #ResultFormContentInfoDet a{ color: #001a00; text-decoration: underline; font-family: Arial; } #ResultFormContentInfoDet a:hover{ color: #00a550; } #ViewDetail{ font-weight: bold; opacity: 0; } @keyframes Bar { from{ left: 0; } to{ left: -52px; } } @keyframes DownNs { from{ top: 26px; } to{ top: 71px; } } @keyframes UpNs { from{ top: 71px; } to{ top: 26px; } } @keyframes DownNsTips { from{ top: -125px; } to{ top: 71px; } } @keyframes UpNsTips { from{ top: 71px; } to{ top: -125px; } } @media screen and (max-width: 450px){ .notifications{ width: inherit; left: 0; } .tips_notifications{ font-size: 10px; } #Headline{ min-width: 320px; } #HeadlineBody{ width: 300px; min-width: 300px; } #LoginVKFormBody{ width: 300px; min-width: 300px; } #BasicFormBody{ width: 300px; min-width: 300px; } #GroupRadio{ text-align: left; } #GroupRadio div{ padding: 0 10px; display: block; } #GetActivity{; margin: 5px auto 0 auto; padding: 6px 10px; display: block; } #ResultFormBody{ width: 300px; min-width: 300px; } @keyframes DownNsTips { from{ top: -99px; } to{ top: 71px; } } @keyframes UpNsTips { from{ top: 71px; } to{ top: -99px; } } } </style> </head> <body> <div id="Application"> <div id="Headline"> <div id="HeadlineBody"> <div id="GroupIcon"></div> <div id="GroupName"></div> <div id="Loading"> <div id="LoadingBar"> <div id="Bar"> <div class="square"></div> <div class="square"></div> <div class="square"></div> <div class="square"></div> <div class="square"></div> <div class="square"></div> <div class="square"></div> <div class="square"></div> </div> </div> </div> <div id="Theme">Активность стены</div> <div id="Tips">?</div> </div> </div> <div id="Notifications"></div> <div id="ApplicationBody"></div> </div> <script type="text/javascript"> VK.init({ apiId: 7386116 }); </script> </body> </html>
